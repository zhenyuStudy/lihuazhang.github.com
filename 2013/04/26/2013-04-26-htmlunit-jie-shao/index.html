<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>HtmlUnit 介绍 | 八点下班</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在 @Lily 的 Juint4 + WebDriver 入门篇 中， Lily 问起了 HtmlUnit Driver。对 HtmlUnit Driver 我倒是没有接触太多， 所以特意去找了些文章看看。
在 selenium 官方 wiki 上说：

This is currently the fastest and most lightweight implementation of Web">
<meta property="og:type" content="article">
<meta property="og:title" content="HtmlUnit 介绍">
<meta property="og:url" content="http://8atmyhouse.com/2013/04/26/2013-04-26-htmlunit-jie-shao/index.html">
<meta property="og:site_name" content="八点下班">
<meta property="og:description" content="在 @Lily 的 Juint4 + WebDriver 入门篇 中， Lily 问起了 HtmlUnit Driver。对 HtmlUnit Driver 我倒是没有接触太多， 所以特意去找了些文章看看。
在 selenium 官方 wiki 上说：

This is currently the fastest and most lightweight implementation of Web">
<meta property="og:updated_time" content="2015-12-16T13:41:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HtmlUnit 介绍">
<meta name="twitter:description" content="在 @Lily 的 Juint4 + WebDriver 入门篇 中， Lily 问起了 HtmlUnit Driver。对 HtmlUnit Driver 我倒是没有接触太多， 所以特意去找了些文章看看。
在 selenium 官方 wiki 上说：

This is currently the fastest and most lightweight implementation of Web">
  
    <link rel="alternative" href="/atom.xml" title="八点下班" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">恒温</a></h1>
		</hgroup>

		
				


		
			<div id="switch-btn" class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">所有文章</a></li>
				        
							<li><a href="/tags/">标签云</a></li>
				        
							<li><a href="/about/">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:lihuazhang@hotmail.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/lihuazhang" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
								<li id="Twitter"><a class="Twitter" target="_blank" href="https://twitter.com/lihuazhang" title="Twitter"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/metro/" style="font-size: 10px;">Metro</a> <a href="/tags/capybara/" style="font-size: 17.5px;">capybara</a> <a href="/tags/cucumber/" style="font-size: 15px;">cucumber</a> <a href="/tags/factory-gril/" style="font-size: 10px;">factory_gril</a> <a href="/tags/git/" style="font-size: 12.5px;">git</a> <a href="/tags/nexus-7-2013/" style="font-size: 10px;">nexus 7 2013</a> <a href="/tags/pageobject/" style="font-size: 12.5px;">pageobject</a> <a href="/tags/test-china-org/" style="font-size: 20px;">test-china.org</a> <a href="/tags/vim/" style="font-size: 12.5px;">vim</a> <a href="/tags/xpath/" style="font-size: 10px;">xpath</a> <a href="/tags/性能测试/" style="font-size: 10px;">性能测试</a> <a href="/tags/游戏开发/" style="font-size: 10px;">游戏开发</a> <a href="/tags/翻译/" style="font-size: 10px;">翻译</a> <a href="/tags/陆犯焉识/" style="font-size: 10px;">陆犯焉识</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">平和而有力量</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">恒温</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">恒温</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">所有文章</a></li>
		        
					<li><a href="/tags/">标签云</a></li>
		        
					<li><a href="/about/">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:lihuazhang@hotmail.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/lihuazhang" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
								<li id="Twitter"><a class="Twitter" target="_blank" href="https://twitter.com/lihuazhang" title="Twitter"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2013-04-26-htmlunit-jie-shao" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/26/2013-04-26-htmlunit-jie-shao/" class="article-date">
  	<time datetime="2013-04-26T13:37:00.000Z" itemprop="datePublished">2013-04-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      HtmlUnit 介绍
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/webdriver/">WebDriver</a>
	</div>


        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test-china-org/">test-china.org</a></li></ul>
	</div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>在 @Lily 的 <a href="http://test-china.org/topics/8" target="_blank" rel="external">Juint4 + WebDriver 入门篇</a> 中， Lily 问起了 HtmlUnit Driver。对 HtmlUnit Driver 我倒是没有接触太多， 所以特意去找了些文章看看。</p>
<p>在 <a href="http://code.google.com/p/selenium/wiki/HtmlUnitDriver" target="_blank" rel="external">selenium 官方 wiki</a> 上说：</p>
<blockquote>
<p>This is currently the fastest and most lightweight implementation of WebDriver. As the name suggests, this is based on HtmlUnit.</p>
</blockquote>
<p>所以想要了解 HtmlUnit Driver， 就必先追根溯源地研究下 HtmlUnit。</p>
<blockquote>
<p>HtmlUnit is a “GUI-Less browser for Java programs”. It models HTML documents and provides an API that allows you to invoke pages, fill out forms, click links, etc… just like you do in your “normal” browser.</p>
</blockquote>
<p>简单来说， HtmlUnit 就是没有界面的，你看不见的，但是却能做浏览器的活的 JAVA 版本的浏览器。需要说明的是，<strong>HtmlUnit 本身不是一个测试框架， 它真的只是一个模拟浏览器行为的程序。</strong> 所以需要和 Junit 或者 TestNG 等测试框架配合起来使用。同时，很多开源的工具也使用 HtmlUnit 来模拟浏览器行为，比如大名鼎鼎的 WebDriver。</p>
<p>下面，搬抄一把 HtmlUnit 的入门指南：</p>
<h2 id="u5EFA_u7ACB_u9879_u76EE"><a href="#u5EFA_u7ACB_u9879_u76EE" class="headerlink" title="建立项目"></a>建立项目</h2><p>使用 maven 创建一个 htmlunit 的试用项目</p>
<pre><code>mvn archetype:generate -DgroupId=com.testchina -DartifactId=my-htmlunit-test -DinteractiveMode=false
</code></pre><p>（不得不夸下 Maven， 构建的好工具啊。）</p>
<p>修改 pom.xml， 加入 HtmlUnit 依赖， 升级 Junit 为4.10。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">project</span> <span class="attribute">xmlns</span>=<span class="value">"http://maven.apache.org/POM/4.0.0"</span> <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">  <span class="attribute">xsi:schemaLocation</span>=<span class="value">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="title">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.testchina<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>my-htmlunit-test<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="title">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">name</span>&gt;</span>my-htmlunit-test<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="title">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="title">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>net.sourceforge.htmlunit<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>htmlunit<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.10<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后，执行：</p>
<ol>
<li><code>mvn install</code></li>
<li><code>mvn eclipse:eclipse</code></li>
</ol>
<p>之后， 就可以在 eclipse 里导入项目。接着，我们来写第一个例子。</p>
<h2 id="u8BD5_u7528"><a href="#u8BD5_u7528" class="headerlink" title="试用"></a>试用</h2><p><strong>第一个例子：</strong></p>
<p>a. 访问 <a href="http://htmlunit.sourceforge.net" target="_blank" rel="external">http://htmlunit.sourceforge.net</a></p>
<p>b. 验证网页的 titile</p>
<p>c. 验证网页内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testchina;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> com.gargoylesoftware.htmlunit.WebClient;</span><br><span class="line"><span class="keyword">import</span> com.gargoylesoftware.htmlunit.html.HtmlPage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHtmlUnitTest</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">homePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient(); <span class="comment">// 建立 WebClient。</span></span><br><span class="line">        <span class="keyword">final</span> HtmlPage page = webClient.getPage(<span class="string">"http://htmlunit.sourceforge.net"</span>); <span class="comment">// 访问网站，返回页面对象。</span></span><br><span class="line">        assertEquals(<span class="string">"HtmlUnit - Welcome to HtmlUnit"</span>, page.getTitleText()); <span class="comment">// 验证 title。</span></span><br><span class="line">        <span class="comment">/** 验证网页内容 */</span></span><br><span class="line">        <span class="keyword">final</span> String pageAsXml = page.asXml();</span><br><span class="line">        assertTrue(pageAsXml.contains(<span class="string">"&lt;body class=\"composite\"&gt;"</span>));</span><br><span class="line">        <span class="keyword">final</span> String pageAsText = page.asText();</span><br><span class="line">        assertTrue(pageAsText.contains(<span class="string">"Support for the HTTP and HTTPS protocols"</span>));</span><br><span class="line">        webClient.closeAllWindows();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第二个例子: 指定浏览器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">homePage_Firefox</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient(BrowserVersion.FIREFOX_10);</span><br><span class="line">    <span class="keyword">final</span> HtmlPage page = webClient</span><br><span class="line">            .getPage(<span class="string">"http://htmlunit.sourceforge.net"</span>);</span><br><span class="line">    assertEquals(<span class="string">"HtmlUnit - Welcome to HtmlUnit"</span>, page.getTitleText());</span><br><span class="line"></span><br><span class="line">    webClient.closeAllWindows();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，在初始化 WebClient 的时候，传入浏览器版本， 目前 2.10 里面支持：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Register plugins for the browser versions. */</span></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       INTERNET_EXPLORER_6.initDefaultFeatures();</span><br><span class="line">       INTERNET_EXPLORER_7.initDefaultFeatures();</span><br><span class="line">       INTERNET_EXPLORER_8.initDefaultFeatures();</span><br><span class="line"></span><br><span class="line">       FIREFOX_3.initDefaultFeatures();</span><br><span class="line">       FIREFOX_3_6.initDefaultFeatures();</span><br><span class="line">       FIREFOX_10.initDefaultFeatures();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> PluginConfiguration flash = <span class="keyword">new</span> PluginConfiguration(<span class="string">"Shockwave Flash"</span>,</span><br><span class="line">           <span class="string">"Shockwave Flash 9.0 r31"</span>, <span class="string">"libflashplayer.so"</span>);</span><br><span class="line">       flash.getMimeTypes().add(<span class="keyword">new</span> PluginConfiguration.MimeType(<span class="string">"application/x-shockwave-flash"</span>,</span><br><span class="line">           <span class="string">"Shockwave Flash"</span>, <span class="string">"swf"</span>));</span><br><span class="line">       FIREFOX_3.getPlugins().add(flash);</span><br><span class="line">       FIREFOX_3_6.getPlugins().add(flash);</span><br><span class="line">       FIREFOX_10.getPlugins().add(flash);</span><br><span class="line"></span><br><span class="line">       CHROME_16.initDefaultFeatures();</span><br><span class="line">       CHROME_16.setApplicationCodeName(<span class="string">"Mozilla"</span>);</span><br><span class="line">       CHROME_16.setPlatform(<span class="string">"MacIntel"</span>);</span><br><span class="line">       CHROME_16.setCpuClass(<span class="keyword">null</span>);</span><br><span class="line">       CHROME_16.setBrowserLanguage(<span class="string">"undefined"</span>);</span><br><span class="line">       <span class="comment">// there are other issues with Chrome; a different productSub, etc.</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>第三个例子： 获取页面元素</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getElements</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient();</span><br><span class="line">    <span class="keyword">final</span> HtmlPage page = webClient.getPage(<span class="string">"http://htmlunit.sourceforge.net"</span>);</span><br><span class="line">    <span class="comment">//get list of all divs</span></span><br><span class="line">    <span class="keyword">final</span> List&lt;?&gt; divs = page.getByXPath(<span class="string">"//div"</span>); <span class="comment">// 返回所有的div</span></span><br><span class="line">    System.out.println(((HtmlDivision)divs.get(<span class="number">0</span>)).asText()); <span class="comment">// 得到第一个 Div 节点的内容。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 返回所有的超链接， 并打印 name 属性*/</span></span><br><span class="line">    <span class="keyword">final</span> List&lt;HtmlAnchor&gt; anchors = page.getAnchors();</span><br><span class="line">    <span class="keyword">for</span> (HtmlAnchor anchor : anchors) &#123;</span><br><span class="line">        System.out.println(anchor.getAttribute(<span class="string">"name"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    webClient.closeAllWindows();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第四个例子： 提交表单</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submittingForm</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the first page</span></span><br><span class="line">    <span class="keyword">final</span> HtmlPage page1 = webClient.getPage(<span class="string">"http://some_url"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the form that we are dealing with and within that form,</span></span><br><span class="line">    <span class="comment">// find the submit button and the field that we want to change.</span></span><br><span class="line">    <span class="keyword">final</span> HtmlForm form = page1.getFormByName(<span class="string">"myform"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> HtmlSubmitInput button = form.getInputByName(<span class="string">"submitbutton"</span>);</span><br><span class="line">    <span class="keyword">final</span> HtmlTextInput textField = form.getInputByName(<span class="string">"userid"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Change the value of the text field</span></span><br><span class="line">    textField.setValueAttribute(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now submit the form by clicking the button and get back the second page.</span></span><br><span class="line">    <span class="keyword">final</span> HtmlPage page2 = button.click();</span><br><span class="line"></span><br><span class="line">    webClient.closeAllWindows();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>是不是很棒？ 所有浏览器能做的，它都能做，我们再来看下它的特性：</p>
<ul>
<li>支持 HTTP and HTTPS 协议</li>
<li>支持 cookies</li>
<li>支持 Post， Get， Head， Delete</li>
<li>支持代理</li>
<li>能分析 HTTP responses</li>
<li>能自定义 HTTP request head</li>
<li>支持 Javascript</li>
</ul>
<p>于是有<br><strong>第五个例子： 使用 javascript</strong></p>
<p>这里的 Javascript 的意思，是指 HtmlUnit 可以通过 js 引擎执行 javascript 代码。</p>
<blockquote>
<p>HtmlUnit provides excellent JavaScript support, simulating the behavior of the configured browser (Firefox or Internet Explorer). It uses the Rhino JavaScript engine for the core language (plus workarounds for some Rhino bugs) and provides the implementation for the objects specific to execution in a browser.</p>
</blockquote>
<p>比如我们的页面有一个 alert 事件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span><span class="tag">&lt;<span class="title">head</span>&gt;</span><span class="tag">&lt;<span class="title">title</span>&gt;</span>Alert sample<span class="tag">&lt;/<span class="title">title</span>&gt;</span><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span> <span class="attribute">onload</span>=<span class="value">'alert("foo");'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们如何捕捉它呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">alerts</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List collectedAlerts = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    webClient.setAlertHandler(<span class="keyword">new</span> CollectingAlertHandler(collectedAlerts));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Since we aren't actually manipulating the page, we don't assign</span></span><br><span class="line">    <span class="comment">// it to a variable - it's enough to know that it loaded.</span></span><br><span class="line">    webClient.getPage(<span class="string">"http://tciludev01/test.html"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List expectedAlerts = Collections.singletonList(<span class="string">"foo"</span>);</span><br><span class="line">    assertEquals(expectedAlerts, collectedAlerts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是不是很轻巧？ 像真正的浏览器一样， HtmlUnit 可以响应各种 Javascript 事件， 执行各种 Javascript 代码。</p>
<hr>
<p>对于 HtmlUnit， 我就初略看了看， 总的印象是轻，不用启动笨重的浏览器就能做到和浏览器一样的行为， 和 Junit4 很好的搭配，可以<br>写出轻巧优美的测试案例， 同时也能为测试省去不少时间。这在前期测试驱动开发的时候，特别是 Web 应用开发，可以节省去不少时间。</p>
<p>参见:</p>
<p><a href="http://htmlunit.sourceforge.net/" target="_blank" rel="external">http://htmlunit.sourceforge.net/</a></p>
<p><a href="http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html" target="_blank" rel="external">http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html</a></p>
<p><a href="http://code.google.com/p/selenium/wiki/HtmlUnitDriver" target="_blank" rel="external">http://code.google.com/p/selenium/wiki/HtmlUnitDriver</a></p>
<p><a href="http://htmlunit.sourceforge.net/javascript-howto.html" target="_blank" rel="external">http://htmlunit.sourceforge.net/javascript-howto.html</a></p>

      
    </div>
    
  </div>
  
    
<div class="copyright">
  <p><span>本文标题:</span><a href="/2013/04/26/2013-04-26-htmlunit-jie-shao/">HtmlUnit 介绍</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 恒温 的个人博客">恒温</a></p>
  <p><span>发布时间:</span>2013年04月26日 - 21时37分</p>
  <p><span>最后更新:</span>2015年12月16日 - 21时41分</p>
  <p>
    <span>原始链接:</span><a class="post-url" href="/2013/04/26/2013-04-26-htmlunit-jie-shao/" title="HtmlUnit 介绍">http://8atmyhouse.com/2013/04/26/2013-04-26-htmlunit-jie-shao/</a>
    <span class="copy-path" data-clipboard-text="原文: http://8atmyhouse.com/2013/04/26/2013-04-26-htmlunit-jie-shao/　　作者: 恒温" title="点击复制文章链接">
        <i class="fa fa-clipboard"></i>
    </span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p>
  <script src="/js/clipboard.min.js"></script>
  <script> var clipboard = new Clipboard('.copy-path'); </script>
</div>




<nav id="article-nav">
  
    <div id="article-nav-newer" class="article-nav-title">
      <a href="/2013/04/27/2013-04-27-jmeter-bing-qi-pu-zhi-regular-expression-extractor/">
        Jmeter 兵器谱之 Regular Expression Extractor
      </a>
    </div>
  
  
    <div id="article-nav-older" class="article-nav-title">
      <a href="/2013/03/21/2013-03-21-windowsxia-cha-zhao-zhan-yong-duan-kou-de-jin-cheng/">
        windows 下查找占用端口的进程
      </a>
    </div>
  
</nav>

  
</article>

<!-- 默认显示文章目录，在文章---前输入toc: false关闭目录 -->
<!-- Show TOC and tocButton in default, Hide TOC via putting "toc: false" before "---" at [post].md -->
<div id="toc" class="toc-article">
<strong class="toc-title">文章目录</strong>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#u5EFA_u7ACB_u9879_u76EE"><span class="toc-number">1.</span> <span class="toc-text">建立项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u8BD5_u7528"><span class="toc-number">2.</span> <span class="toc-text">试用</span></a></li></ol>
</div>
<style type="text/css">
  .left-col .switch-btn {
    display: none;
  }
  .left-col .switch-area {
    display: none;
  }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">
<script type="text/javascript">
  var toc_button= document.getElementById("tocButton");
  var toc_div= document.getElementById("toc");
  /* Show or hide toc when click on tocButton.
  通过点击设置的按钮显示或者隐藏文章目录.*/
  toc_button.onclick=function(){
  if(toc_div.style.display=="none"){
  toc_div.style.display="block";
  toc_button.value="隐藏目录";
  document.getElementById("switch-btn").style.display="none";
  document.getElementById("switch-area").style.display="none";
  }
  else{
  toc_div.style.display="none";
  toc_button.value="显示目录";
  document.getElementById("switch-btn").style.display="block";
  document.getElementById("switch-area").style.display="block";
  }
  }
</script>

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
  if ($(".toc").length < 1) {
    $("#toc").css("display","none");
    $("#tocButton").css("display","none");
    $(".switch-btn").css("display","block");
    $(".switch-area").css("display","block");
  }
</script>


<div class="share">
	<div class="bdsharebuttonbox">
	<a href="#" class="bds_more" data-cmd="more"></a>
	<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
	<a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
	<a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
	<a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
	</div>
	<script>
	window._bd_share_config={
		"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
	</script>
</div>



  <div class="duoshuo" id="comments">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2013/04/26/2013-04-26-htmlunit-jie-shao/" data-title="HtmlUnit 介绍" data-url="http://8atmyhouse.com/2013/04/26/2013-04-26-htmlunit-jie-shao/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"jinhengwen"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>






    <style type="text/css">
    #scroll {
      display: none;
    }
    </style>
    <div class="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
    </div>


  
  
    
    <div  class="post-nav-button">
    <a href="/2013/04/27/2013-04-27-jmeter-bing-qi-pu-zhi-regular-expression-extractor/" title="上一篇: Jmeter 兵器谱之 Regular Expression Extractor">
    <i class="fa fa-angle-left"></i>
    </a>
    <a href="/2013/03/21/2013-03-21-windowsxia-cha-zhao-zhan-yong-duan-kou-de-jin-cheng/" title="下一篇: windows 下查找占用端口的进程">
    <i class="fa fa-angle-right"></i>
    </a>
    </div>
  



    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
     
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2015 恒温
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="site-visit" >本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style='display:none'>
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>