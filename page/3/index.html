<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>八点下班</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="其实一直是想晚上八点能在家，但是现在下班也是种奢望。">
<meta property="og:type" content="website">
<meta property="og:title" content="八点下班">
<meta property="og:url" content="http://8atmyhouse.com/page/3/index.html">
<meta property="og:site_name" content="八点下班">
<meta property="og:description" content="其实一直是想晚上八点能在家，但是现在下班也是种奢望。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="八点下班">
<meta name="twitter:description" content="其实一直是想晚上八点能在家，但是现在下班也是种奢望。">
  
    <link rel="alternative" href="/atom.xml" title="八点下班" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  <div id="top"></div>
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">恒温</a></h1>
		</hgroup>

		
				


		
			<div id="switch-btn" class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">所有文章</a></li>
				        
							<li><a href="/tags/">标签云</a></li>
				        
							<li><a href="/about/">关于我</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:lihuazhang@hotmail.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/lihuazhang" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
								<li id="Twitter"><a class="Twitter" target="_blank" href="https://twitter.com/lihuazhang" title="Twitter"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/metro/" style="font-size: 10px;">Metro</a> <a href="/tags/capybara/" style="font-size: 17.5px;">capybara</a> <a href="/tags/cucumber/" style="font-size: 15px;">cucumber</a> <a href="/tags/factory-gril/" style="font-size: 10px;">factory_gril</a> <a href="/tags/git/" style="font-size: 12.5px;">git</a> <a href="/tags/nexus-7-2013/" style="font-size: 10px;">nexus 7 2013</a> <a href="/tags/pageobject/" style="font-size: 12.5px;">pageobject</a> <a href="/tags/test-china-org/" style="font-size: 20px;">test-china.org</a> <a href="/tags/vim/" style="font-size: 12.5px;">vim</a> <a href="/tags/xpath/" style="font-size: 10px;">xpath</a> <a href="/tags/南京/" style="font-size: 10px;">南京</a> <a href="/tags/性能测试/" style="font-size: 10px;">性能测试</a> <a href="/tags/游戏开发/" style="font-size: 10px;">游戏开发</a> <a href="/tags/移动测试/" style="font-size: 10px;">移动测试</a> <a href="/tags/翻译/" style="font-size: 10px;">翻译</a> <a href="/tags/陆犯焉识/" style="font-size: 10px;">陆犯焉识</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">平和而有力量</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">恒温</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">恒温</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">所有文章</a></li>
		        
					<li><a href="/tags/">标签云</a></li>
		        
					<li><a href="/about/">关于我</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="Email"><a class="Email" target="_blank" href="mailto:lihuazhang@hotmail.com" title="Email"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/lihuazhang" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
								<li id="Twitter"><a class="Twitter" target="_blank" href="https://twitter.com/lihuazhang" title="Twitter"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-2013-06-26-shell-script-to-control-tomcat" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/06/26/2013-06-26-shell-script-to-control-tomcat/" class="article-date">
  	<time datetime="2013-06-26T13:37:00.000Z" itemprop="datePublished">2013-06-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/06/26/2013-06-26-shell-script-to-control-tomcat/">能马上用起来的控制 tomcat 的脚本</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>难的在网上找到的能马上用起来的 shell 脚本，心情愉悦啊！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line"><span class="built_in">export</span> BASE=/home/programs/jakarta-tomcat-5.0.28/bin</span><br><span class="line">prog=jakarta-tomcat-5.0.28</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stat</span></span>() &#123;</span><br><span class="line"><span class="keyword">if</span> [ `ps auxwwww|grep <span class="variable">$prog</span>|grep -v grep|wc <span class="_">-l</span>` <span class="_">-gt</span> 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> Tomcat is running.</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> Tomcat is not running.</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ `ps auxwwww|grep <span class="variable">$prog</span>|grep -v grep|wc <span class="_">-l</span>` <span class="_">-gt</span> 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> Tomcat seems to be running. Use the restart option.</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="variable">$BASE</span>/startup.sh 2&gt;&amp;1 &gt; /dev/null</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line"><span class="variable">$BASE</span>/shutdown.sh 2&gt;&amp;1 &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ `ps auxwwww|grep <span class="variable">$prog</span>|grep -v grep|wc <span class="_">-l</span>` <span class="_">-gt</span> 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">for</span> pid <span class="keyword">in</span> `ps auxwww|grep <span class="variable">$prog</span>|grep -v grep|tr <span class="_">-s</span> <span class="string">' '</span>|cut <span class="_">-d</span> <span class="string">' '</span> <span class="_">-f</span>2`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$pid</span> 2&gt;&amp;1 &gt; /dev/null</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ `ps auxwwww|grep <span class="variable">$prog</span>|grep -v grep|wc <span class="_">-l</span>` <span class="_">-gt</span> 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">for</span> pid <span class="keyword">in</span> `ps auxwww|grep <span class="variable">$prog</span>|grep -v grep|tr <span class="_">-s</span> <span class="string">' '</span>|cut <span class="_">-d</span> <span class="string">' '</span> <span class="_">-f</span>2`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$pid</span> 2&gt;&amp;1 &gt; /dev/null</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="variable">$BASE</span>/startup.sh 2&gt;&amp;1 &gt; /dev/null</span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line">;;</span><br><span class="line">status)</span><br><span class="line"><span class="built_in">stat</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Usage: tomcat start|stop|restart|status"</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<p>参见 <a href="http://www.techpaste.com/2012/01/shell-script-control-stopstartrestartstatus-tomcat-application-server/" target="_blank" rel="external">http://www.techpaste.com/2012/01/shell-script-control-stopstartrestartstatus-tomcat-application-server/</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/linux/">linux</a>
	</div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-05-26-zai-webdriverli-shi-yong-sizzle-dot-js" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/05/26/2013-05-26-zai-webdriverli-shi-yong-sizzle-dot-js/" class="article-date">
  	<time datetime="2013-05-26T13:37:00.000Z" itemprop="datePublished">2013-05-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/05/26/2013-05-26-zai-webdriverli-shi-yong-sizzle-dot-js/">在WebDriver里使用Sizzle.js</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p>##XPATH vs CSS</p>
<p>2008年的时候， 开始使用 Selenium RC 来写 Web 自动化测试，用的是 XPATH 定位，在 Firefox 上工作的很好，可惜在 IE 上跑不起来。<br>因为后来转去做开发工作，对此问题也没深究。时隔5年，09年时候转测试，已经4年多了。Selenium RC 都变成了 WebDriver， 从2013 GTAC 来看，<br>WebDriver 逐渐成为 Web 自动化的主流框架。</p>
<p>WebDriver 同样使用 XPATH 和 CSS locator。孰优孰劣，google 一下，一大把，不过目前风向偏向 CSS， 理由如下</p>
<ol>
<li>更快(尤其在 IE 上)</li>
<li>更简单</li>
<li>更加可读</li>
<li>符合 Jquery 定位逻辑</li>
<li>XPATH 在不同浏览器上的实现可能不太一样，也许在 Firefox 工作，在 IE 上就不一定了。</li>
<li>CSS 可以引入第三方的 Javascript 库来更好的定位元素， 比如马上要说的 Sizzle.js</li>
</ol>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/webdriver/">WebDriver</a>
	</div>


      
      
        <p class="article-more-link">
          <a  href="/2013/05/26/2013-05-26-zai-webdriverli-shi-yong-sizzle-dot-js/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-05-12-wo-de-mu-qin" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/05/12/2013-05-12-wo-de-mu-qin/" class="article-date">
  	<time datetime="2013-05-12T13:37:00.000Z" itemprop="datePublished">2013-05-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/05/12/2013-05-12-wo-de-mu-qin/">我的母亲</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>有一次，和妻逛超市，谈起了龙应台的目送里其中一个描述母亲的片段，“母亲是搭错了时光机，再也回不来的人。” 后来回到家后，又把书翻出来，重新看了一遍并又和妻说了一遍。我说我妈大概也会变成那样吧。妻说怎会呢，然后想了下，我妈才会呢。</p>
<p>于是突然就很想说说我的母亲。虽然她现在还没有老到糊涂，但是她也藏不住白头发，牙齿也掉了几颗，化妆品也修不好皱纹。时光像一个油画大师，把浓郁的岁月，刻画在她的身上。</p>
<p>每天，她会在那里抱怨，腰酸背痛啊，骨刺啊，颈椎病啊。但饶是如此，却阻止不了她的大嗓门，每个清晨，每个晚上，家里永远是她的声音。而一旦她出门在外，家里就瞬间安静。很久以前，我的外婆也是大嗓门，外婆喊我回家吃饭的声音隔了那么多年，还常常在我耳边回响，即使她已经故去。</p>
<p>母亲年轻的时候，总是抱怨外婆的大嗓门，却不知自己慢慢也成为她抱怨的那种人。外婆说，哪一天我声音轻了，我就死了。后来她真的去了，一点声音都没。</p>
<p>我也常抱怨母亲的大嗓门，有时候实在受不了的时候，就会责怪她，说轻点，会死么？她就会突然不说话，然后把外婆的话说一遍，等我轻的时候，就是我死的时候。</p>
<p>很多人觉得母亲不好，也会和妻说母亲很烦，妻也善解人意，笑笑而已。我想说，其实年轻时候，母亲倒是不烦人的。家里有男人顶着，什么事情也不用管，虽然生活不殷实，也无忧无虑。但是如果儿子五岁丧夫，儿子读大学第二任丈夫又重病缠身至今，哪个女人会不成为祥林嫂？在两次都本应该幸福的时候，总是祸不单行。</p>
<p>母亲进入更年期后，便再也没有出来过。加之父亲重病，家就成了蜗牛壳，母亲一个人背着，还得向前走。于是所有的外交都成了母亲的活，生病之后，父亲变成了一个怕事怕麻烦的人。所以，不行，不好，不准成就了母亲的黑脸，而父亲就成了老好人。家里的房客有事相求的时候，总是偷偷和父亲说，末了还加一句，别给阿姨知道。</p>
<p>家里没有男人顶粱的时候，总是有人欺负。所以不把得以把自己变成男人。所有的人都成了敌人。而父亲病后，家里经济也出现了问题，除了照顾父亲之外还要拼命工作。而在异地上大学的我却依然浑浑噩噩，生活费一分不少的往家里要，课也照样挂。家那头的母亲在通宵为父亲挂号，在严夏烈日下，在狂风嫉雨中，工作挣生计。</p>
<p>这样的生活，直到我大学毕业，慢慢在工作上有所长进，才有所起色。父亲的病也日趋稳定，可以洗洗刷刷。而我开始成家立业。所有人都慢慢的起色起来。只有母亲，依然活在那段困苦的日子里出不来，她依旧大嗓门，依旧黑脸，依旧固执地对所有人都有所戒备。但她依然是我的母亲。</p>
<p>生活在一起的时候，总是讨厌她的啰嗦，她的大嗓门念叨，也从心里不喜欢她的世界观。但是也许很多年后，一定还是会和妻说起，或者和我的孩子说起，母亲就是那个会在你睡着以后，还把你叫醒，告诉你要睡觉的人。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/生活杂记/">生活杂记</a>
	</div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-04-30-webdriver-zhi-ce-shi-shi-bai-zi-dong-jie-tu" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/30/2013-04-30-webdriver-zhi-ce-shi-shi-bai-zi-dong-jie-tu/" class="article-date">
  	<time datetime="2013-04-30T13:37:00.000Z" itemprop="datePublished">2013-04-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/04/30/2013-04-30-webdriver-zhi-ce-shi-shi-bai-zi-dong-jie-tu/">WebDriver 之测试失败自动截图</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>写 webDriver 测试的时候最头疼的就是调试。 但也远不及运行的时候出错，再回头调试来的痛苦。总所周知， web 自动化的代码都非常脆弱，一份代码一会运行失败，一会运行成功也是很正常的事情。总的来说造成案例运行失败的原因大抵有两点：</p>
<ul>
<li>环境问题： 比如网络不稳定啊</li>
<li>代码变动： 比如某个元素不在</li>
<li>遇到 bug ：这就是真的发现 bug 了</li>
</ul>
<p>无论哪一种，遇到了都需要花一番时间去 debug。那如果这个时候有一张运行时候出错的截图，那就一目了然了。（即便不一目了然，也有很多帮助）</p>
<p>在运行出错的时候，捕获错误并截图有两种思路：</p>
<ol>
<li>自定义一个 WeDdriver 的监听器，在出异常的时候截图。</li>
<li>利用 Juint 的 TestRule， 自定义一个 Rule 在运行失败的时候截图。</li>
</ol>
<h2 id="自定义监听器"><a href="#自定义监听器" class="headerlink" title="自定义监听器"></a>自定义监听器</h2><hr>
<p><strong>截图的原理</strong></p>
<p>截图需要用到 RemoteWebDriver。在 <a href="http://code.google.com/p/selenium/wiki/RemoteWebDriver" target="_blank" rel="external">Selenium</a> 官方我们可以找到：</p>
<blockquote>
<p>One nice feature of the remote<br>webdriver is that exceptions often<br>have an attached screen shot, encoded<br>as a Base64 PNG. In order to get this<br>screenshot, you need to write code<br>similar to:</p>
</blockquote>
<pre><code>public String extractScreenShot(WebDriverException e) {
  Throwable cause = e.getCause();
  if (cause instanceof ScreenshotException) {
    return ((ScreenshotException) cause).getBase64EncodedScreenshot();
  }
  return null;
}
</code></pre><p>意思就是说，每个异常都是 ScreenshotException 的对象，转码一下就可以用了。这是截图的本质。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.internal.Base64Encoder;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.remote.ScreenshotException;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.support.events.AbstractWebDriverEventListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * This is an customized webdriver event listener.</span><br><span class="line"> * Now it implements onException method: webdriver will take a screenshot</span><br><span class="line"> * when it meets an exception. It's good but not so usable. And when we use</span><br><span class="line"> * WebDriverWait to wait for an element appearing, the webdriver will throw</span><br><span class="line"> * exception always and the onException will be excuted again and again, which</span><br><span class="line"> * generates a lot of screenshots.</span><br><span class="line"> * Put here for study</span><br><span class="line"> * Usage:</span><br><span class="line"> *      WebDriver driver = new FirefoxDriver();</span><br><span class="line"> *      WebDriverEventListener listener = new CustomWebDriverEventListener();</span><br><span class="line"> *      return new EventFiringWebDriver(driver).register(listener);</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@author</span> qa</span><br><span class="line"> *</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomWebDriverEventListener</span> <span class="keyword">extends</span></span><br><span class="line">        <span class="title">AbstractWebDriverEventListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onException</span><span class="params">(Throwable throwable, WebDriver driver)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Throwable cause = throwable.getCause();</span><br><span class="line">        <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> ScreenshotException) &#123;</span><br><span class="line">            SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(</span><br><span class="line">                    <span class="string">"yyyy-MM-dd-hh-mm-ss"</span>);</span><br><span class="line">            String dateString = formatter.format(<span class="keyword">new</span> Date());</span><br><span class="line">            File of = <span class="keyword">new</span> File(dateString + <span class="string">"-exception.png"</span>);</span><br><span class="line">            FileOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                out = <span class="keyword">new</span> FileOutputStream(of);</span><br><span class="line">                out.write(<span class="keyword">new</span> Base64Encoder()</span><br><span class="line">                        .decode(((ScreenshotException) cause)</span><br><span class="line">                                .getBase64EncodedScreenshot()));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要看 onException 这个方法的实现，很明显， 我们捕获了这个异常， 然后通过强制转换将图片提取出来，写入硬盘。</p>
<p>然后就是使用这个监听器， 通常会在 setup 方法里面将这个监听器注册到 WebDriver 中去， 看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String remote_driver_url = <span class="string">"http://localhost:4444/wd/hub"</span>;</span><br><span class="line">    DesiredCapabilities capability = <span class="keyword">null</span>;</span><br><span class="line">    capability = DesiredCapabilities.firefox();</span><br><span class="line">    WebDriverEventListener eventListener = <span class="keyword">new</span> CustomWebDriverEventListener ();</span><br><span class="line">    WebDriver driver = <span class="keyword">new</span> EventFiringWebDriver(<span class="keyword">new</span> RemoteWebDriver(<span class="keyword">new</span> URL(</span><br><span class="line">                    remote_driver_url), capability)).register(eventListener);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这之后，如果运行出错， WebDriver 抛出异常就会在相应的 classpath 下面生成 png 的截图。</p>
<h2 id="自定义-TestRule"><a href="#自定义-TestRule" class="headerlink" title="自定义 TestRule"></a>自定义 TestRule</h2><hr>
<p>和自定义 WebDriver 监听器不同， 自定义 TestRule 只有在这个 Rule 被执行的时候， 才去做一些我们预设的 CallBack。 所以这个截图动作，对于 WebDriver 而言， 是主动的。 那么，我们就需要自定义一个 RemoteWebDriver 来实现截图功能。 WebDriver 自身提供了 TakesScreenshot  这个接口， 我们只要实现它就可以了， 看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.OutputType;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.TakesScreenshot;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebDriverException;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.remote.CapabilityType;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.remote.DesiredCapabilities;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.remote.DriverCommand;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.remote.RemoteWebDriver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomRemoteWebDriver</span> <span class="keyword">extends</span> <span class="title">RemoteWebDriver</span> <span class="keyword">implements</span></span><br><span class="line">        <span class="title">TakesScreenshot</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomRemoteWebDriver</span><span class="params">(URL url, DesiredCapabilities dc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(url, dc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; <span class="function">X <span class="title">getScreenshotAs</span><span class="params">(OutputType&lt;X&gt; target)</span></span><br><span class="line">            <span class="keyword">throws</span> WebDriverException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((Boolean) getCapabilities().getCapability(</span><br><span class="line">                CapabilityType.TAKES_SCREENSHOT)) &#123;</span><br><span class="line">            <span class="keyword">return</span> target</span><br><span class="line">                    .convertFromBase64Png(execute(DriverCommand.SCREENSHOT)</span><br><span class="line">                            .getValue().toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，我们在加一个封装类， 将截图方法放进去。</p>
<p> WebDriverWrapper.screenShot ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">    * Function to take the screen shot and save it to the classpath dir.</span><br><span class="line">    * Usually, you will find the png file under the project root.</span><br><span class="line">    *</span><br><span class="line">    * <span class="doctag">@param</span> driver</span><br><span class="line">    *            Webdriver instance</span><br><span class="line">    * <span class="doctag">@param</span> desc</span><br><span class="line">    *            The description of the png</span><br><span class="line">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">screenShot</span><span class="params">(WebDriver driver, String desc)</span> </span>&#123;</span><br><span class="line">       Date currentTime = <span class="keyword">new</span> Date();</span><br><span class="line">       SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd-hh-mm-ss"</span>);</span><br><span class="line">       String dateString = formatter.format(currentTime);</span><br><span class="line">       File scrFile = ((TakesScreenshot) driver)</span><br><span class="line">               .getScreenshotAs(OutputType.FILE);</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           desc = desc.trim().equals(<span class="string">""</span>) ? <span class="string">""</span> : <span class="string">"-"</span> + desc.trim();</span><br><span class="line">           File screenshot = <span class="keyword">new</span> File(<span class="string">"screenshot"</span> + File.separator</span><br><span class="line">                   + dateString + desc + <span class="string">".png"</span>);</span><br><span class="line">           FileUtils.copyFile(scrFile, screenshot);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>下面，就是添加 Junit 的 TestRule：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.rules.TestRule;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.Description;</span><br><span class="line"><span class="keyword">import</span> org.junit.runners.model.Statement;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebDriver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TakeScreenshotOnFailureRule</span> <span class="keyword">implements</span> <span class="title">TestRule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebDriver driver;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TakeScreenshotOnFailureRule</span><span class="params">(WebDriver driver)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.driver = driver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Statement <span class="title">apply</span><span class="params">(<span class="keyword">final</span> Statement base, Description description)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Statement() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evaluate</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    base.evaluate();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">                    WebDriverWrapper.screenShot(driver, <span class="string">"assert-fail"</span>);</span><br><span class="line">                    <span class="keyword">throw</span> throwable;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码很简单，在抛出 evalate 方法的错误之前，截图。</p>
<p>然后就是使用这个 TestRule， 很简单，只要在你的 测试用例里面加入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line"><span class="meta">@Rule</span></span><br><span class="line"><span class="keyword">public</span> TestRule myScreenshot = <span class="keyword">new</span> TakeScreenshotOnFailureRule(driver);</span><br><span class="line">...</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即可。关于 Junit 的 Rule 请自行 google！</p>
<h2 id="两则的比较"><a href="#两则的比较" class="headerlink" title="两则的比较"></a>两则的比较</h2><hr>
<p>总得来说，两种方法都很方便， 也很有效果， 基本都能截图成功。</p>
<p>不同之处在于，</p>
<ul>
<li>RemoteWebDriver 监听器是在 RemoteWebDriver 抛出异常的时候截图。</li>
<li>TestRule 是在 assert 失败的时候截图。</li>
</ul>
<p>我在项目中最早是用第一种方法，后来改用第二种，主要是因为，在自定义的监听器里， 它遇到所有的异常都会截图，这个时候，如果你用了 condition wait 一个 Ajax 的元素， 那就会很悲剧，你会发现在你的目录下面有无数的截图。当初我没有找到解决方法，期待有人提出。</p>
<h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><hr>
<ul>
<li><a href="http://code.google.com/p/selenium/wiki/RemoteWebDriver" target="_blank" rel="external">http://code.google.com/p/selenium/wiki/RemoteWebDriver</a></li>
<li><a href="http://magustest.com/blog/webdriver/webdriver-screenshot-on-exception/" target="_blank" rel="external">http://magustest.com/blog/webdriver/webdriver-screenshot-on-exception/</a></li>
<li><a href="http://cwd.dhemery.com/2010/12/junit-rules/" target="_blank" rel="external">http://cwd.dhemery.com/2010/12/junit-rules/</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/webdriver/">WebDriver</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test-china-org/">test-china.org</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-04-29-jmeter-bing-qi-pu-zhi-xpath-extractor" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/29/2013-04-29-jmeter-bing-qi-pu-zhi-xpath-extractor/" class="article-date">
  	<time datetime="2013-04-29T13:37:00.000Z" itemprop="datePublished">2013-04-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/04/29/2013-04-29-jmeter-bing-qi-pu-zhi-xpath-extractor/">Jmeter 兵器谱之 Xpath Extractor</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这主要是 @AskaNeverEnd 引发的血案。AskaNeverEnd 跑去澳洲不学好，用起了 Jmeter。昨天，他突然问了一个问题，如何用 Jmeter 登陆 Https 的网站。于是我就跑去 Jmeter 官网翻有关 SSL 的信息，发现各种纠结。看文档实在是累啊，于是正好手头项目是用 Https， 不妨一试。结果 Https 没怎么试验，倒是体验了一把 Xpath Extractor。</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>大家都知道，传统的表单登陆有几个特点：</p>
<ol>
<li>有一个特定的 action</li>
<li>使用 Post 协议</li>
<li>post 参数一般为用户名和密码</li>
<li>有很多的 hidden input 随机值</li>
</ol>
<p>比如百度的登陆，就有相当多的 hidden input。这些 hidden input 的 value 在每次请求时，都会随机生成不同的值。所以你不得不把它提取出来，参数化。于是我们就用到了 XPATH Extractor。</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>假设我们有这样一个登陆的form：</p>
<pre><code>&lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;
  &lt;input id=&quot;username&quot; name=&quot;username&quot; type=&quot;text&quot; value=&quot;&quot;&gt;
  &lt;input id=&quot;password&quot; name=&quot;password&quot; type=&quot;password&quot; value=&quot;&quot;&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;lt&quot; value=&quot;20120001&quot;&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;_eventId&quot; value=&quot;submit&quot;&gt;
  &lt;input class=&quot;btn-submit&quot; name=&quot;submit&quot; value=&quot;Log In&quot; type=&quot;submit&quot;&gt;
&lt;/form&gt;
</code></pre><p> 可以看到有两个 hidden input， 其中 lt 值是每次刷新页面时候，随机生成的值，另外一个是固定。那我们的策略是：</p>
<ol>
<li>第一次请求这个页面时候，获取随机生成的 lt 值。</li>
<li>用这个获得的 lt 值，和用户名，密码一起做为 post 的参数，传递到后台去。</li>
</ol>
<p>所以在jmeter里面，先创建一个 HTTP 请求，这个请求的作用就是访问网站登录页面，并在这个请求填加后置处理器： XPATH Extractor，来提取请求返回的 html response 里面的 <strong>lt</strong> 的值。</p>
<p><img src="https://jzycow.bn1.livefilestore.com/y1mkZeGi_ZuSphq77cecvcz5J1NwURw4cnG5JgR4Ar0pN2TjMfYVwjllWUY9LM-pWS-m92mtRx6lAvb1hLbYSUpa1Mh__u99xrNRP2-pIqWtum_W_dWGH_J6g/xpath.png?psid=1" alt="alt text"></p>
<p>然后在 XPATH Extractor 里，将要提取 lt 的 XPATH query 填写正确， 如下</p>
<p><img src="https://jzycow.bn1.livefilestore.com/y1mohY_XIe6MBQXnE3vqzOPbsjuuUc6HTUnImhsM8G6n2I5E1ry9mecSCxJuytZWlxGHIsgcNBtSQY-K4PYt1-9xQ9jvbT65BuUt_bRcZWo7tPWYLEq4ryryQ/query.png?psid=1" alt="alt text"></p>
<p>在第一个 http 的请求中，我们取得了 lt 的值。接着我们创建第二个 http request， 这次要完成的就是将这些参数 post 到 form 制定的 action 中去。</p>
<p><img src="https://jzycow.bn1.livefilestore.com/y1mktMNz2jyfvCicq9jS5QnbKT0wNVxDfq13v1MD1QboYPq78Jx8sLv8-YAGaB_waaCQ1c8lDNUISQ8eVIlnfDSVVyuvd6u4cLJE2E5jvnh36rQIymo7wOxLA/http.png?psid=1" alt="alt text" title="12"></p>
<p>需要注意的是，这次的方法变成了 Post， 还有参数都要填写到参数列表中，注意那个 lt 值， jmeter 使用 ${} 获取参数的值。</p>
<p>好，大功告成，试试看吧。</p>
<hr>
<h2 id="XPATH-Extractor-详说"><a href="#XPATH-Extractor-详说" class="headerlink" title="XPATH Extractor 详说"></a>XPATH Extractor 详说</h2><p>盗用下Apache上的图片：<br><img src="http://jmeter.apache.org/images/screenshots/xpath_extractor.png" alt="alt text"></p>
<p>我们来一一解说下，这些图片上的属性，英语好的人可以直接移步 <a href="http://jmeter.apache.org/usermanual/component_reference.html#XPath_Extractor" title="XPATH Extractor" target="_blank" rel="external">Apache Jmeter Xpath Extractor</a>。</p>
<p><strong>Name</strong>： XPATH Extractor， 就是一个该节点的描述信息，你可以任意更改，会立刻反应在你的节点树上。<br><strong>Comments</strong>: 同样也是描述信息。<br><strong>Apply to</strong>：一般只针对于那些有子 sample 的 sample， apply to 有4种：</p>
<ul>
<li>Main sample only： 只对主 sample 起作用。</li>
<li>Sub-samples only: 只对子 sample 起作用。</li>
<li>Main sample and sub-samles: 两种都起作用。</li>
<li>JMeter Varibale: 这个变量是用于 JMeter的assertion， assertion 会对这个变量的内容起作用。</li>
</ul>
<p>XPATH的会对每一个被 <em>Apply to</em> 的 Sample 依次起作用， 并所有的匹配结果都会返回。</p>
<p><strong>XPATH Parsing Options</strong></p>
<p><strong>Use Tidy(tolerant parser)</strong>: 如果选择 Use Tidy， 就是解析response的时候将 HTML 转成 XHTML。</p>
<ul>
<li>对于所有的 HTML response， 我们应该选择 Use Tidy， 这样的 response 会被转为有效的 XHTML。</li>
<li>对于所有的 XHTML 和 XML， 就不需要再选择使用 Use Tidy 了。</li>
</ul>
<p><strong>Quiet</strong>: tidy 的 quiet flag 设置， 选中了会抑制一些不必要的输出。<br><strong>Report error</strong>： 如果 Tidy 发生错误， 那么触发相应的 Assertion。<br><strong>Show warnings</strong>： 显示 Tidy Warning 信息的开关。</p>
<p><strong>Use Namespaces</strong>， <strong>Validate XML</strong>，  <strong>Ignore Whitespace</strong>，  <strong>Fetch External DTDs</strong> 这四个只有在 Use Tidy 没有选中才会被激活。</p>
<p><strong>Use Namespaces</strong>： 如果选中此选项，那么 XML 解析器会使用命名空间，我也不是很熟这一块，可以参考<br><a href="http://www.cnblogs.com/meng-meng/archive/2011/09/26/2192355.html" target="_blank" rel="external">XML解析中的namespace初探</a></p>
<p> <strong>Validate XML</strong>： 验证 XML 是不是 well formed。</p>
<p> <strong>Ignore Whitespace</strong>： 忽略空格字符</p>
<p><strong>Fetch External DTDs</strong>： 获取外部的 DTD 文件</p>
<p><strong>Return entire XPath fragment instead of text content?</strong>： 这个很简单，举个例子：</p>
<p>html 片段是：</p>
<pre><code>&lt;titile&gt;
Apache JMeter
&lt;/title&gt;
</code></pre><p>那么，//title 会返回 “<code>&lt;title&gt;Apache JMeter&lt;/title&gt;</code>“ 而不是 “Apache JMeter”.</p>
<p><strong>Reference Name</strong>： 就是用来存放 XPATH 提取出来的值。<br><strong>XPath Query</strong>： XPATH 的查询语句。<br><strong>Default Value</strong>： 默认值。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/jmeter/">Jmeter</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test-china-org/">test-china.org</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-04-28-jmeter-bing-qi-pu-zhi-foreach-controller" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/28/2013-04-28-jmeter-bing-qi-pu-zhi-foreach-controller/" class="article-date">
  	<time datetime="2013-04-28T13:37:00.000Z" itemprop="datePublished">2013-04-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/04/28/2013-04-28-jmeter-bing-qi-pu-zhi-foreach-controller/">JMeter 兵器谱之 ForEach Controller</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>同样的，英文好的同学请移驾<a href="http://jmeter.apache.org/usermanual/component_reference.html#ForEach_Controller" target="_blank" rel="external">ForEach Controller</a></p>
<p>ForEach controller 是用来遍历集合的，比如 XPATH Extractor 或者 正则表达式 Extractor 解析出来的集合。ForEach做的事情大致有2件，</p>
<ol>
<li>取得集合</li>
<li>遍历集合，将每一个值应用到 ForEach 下面的 Smapler 或者 controller 中去。</li>
</ol>
<p>来看一个例子，我们要访问百度首页，取得首页所有的链接，然后访问这些链接。我们要做的是：</p>
<ol>
<li>用一个 http sample 访问 <a href="http://www.baidu.com" target="_blank" rel="external">http://www.baidu.com</a></li>
<li>在这个 sample 下添加一个正则表达式提取器，使用 &lt;a href=”([^”]+)” 提取所有的 link 的 href 值。</li>
<li>用 ForEach Controller 遍历第2步提取出来的 href 值，然后一一访问。</li>
</ol>
<p>JMeter 脚本结构大致如下，</p>
<p><img src="http://jmeter.apache.org/images/screenshots/logic-controller/foreach-example.png" alt="alt text"></p>
<p>先来看正则表达式提取器</p>
<p><img src="https://ers1ja.bn1.livefilestore.com/y1pDLRMxvFylmW1qmUQUvGe1DJVuwh_KUusRReatQ3QtB4ZxbWAN1HCxgqqZJnl6b9yv1rFXc8mTxe5_1LS4ji1zK4fhsRC6DWr/regular.png?psid=1" alt="alt text"></p>
<p>注意这个引用名称 <strong>inputVar</strong>， 提取出来的所有匹配值都会放在这个变量里，事实上 <strong>inputVar</strong> 相当于一个 set 了。然后我们在紧跟的 ForEach 里面使用这个变量。</p>
<p><img src="https://ers1ja.bn1.livefilestore.com/y1p1K2BOBifU6X2D6r3Ij1cXIrT_D3mwqLArS24AiUmyiIzRzAc6vkXpldU7lxAkQhCWiMmqOoV07DiBMIxJKLyDa4vpJ72qPBp/foreach.png?psid=1" alt="alt text"></p>
<p>可以看到，在 ForEach 里，我们将之前的 <strong>inputVar</strong> 设置为输入变量。然后用 <strong>returnVar</strong> 做为输出。 这其实就类似于 JAVA 里面的 ForEach。</p>
<pre><code>for(Object returnVar : inputVar) {
//process
}
</code></pre><p>这个 process 过程就是下图所示：<br><img src="https://ers1ja.bn1.livefilestore.com/y1pf_N1kVq04KkJwyA20UlawUiT_AmrnaudC6MyqCYrcnRyoer1rJXJEZM_lYgONZgC2IwH99dywgmKiVaFSUkXS3ktzbtHRZZ_/http%201.png?psid=1" alt="alt text"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/jmeter/">Jmeter</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test-china-org/">test-china.org</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-04-27-jmeter-bing-qi-pu-zhi-regular-expression-extractor" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/27/2013-04-27-jmeter-bing-qi-pu-zhi-regular-expression-extractor/" class="article-date">
  	<time datetime="2013-04-27T13:37:00.000Z" itemprop="datePublished">2013-04-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/04/27/2013-04-27-jmeter-bing-qi-pu-zhi-regular-expression-extractor/">Jmeter 兵器谱之 Regular Expression Extractor</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>接着我之前的血案，无意间学会了如何使用Jmeter里面的Regular Expression Extractor。<br>搞定了Jmeter脚本的一些基本配置，然后我开始跑脚本。非常顺利，但是问题也出现了，<br>有个统计多少用户登陆的功能始终显示用户数量稳定在一个数字，没有增加。<br>仔细观察了result tree里面的结果（个人十分喜欢result tree，因为可把request，response看个通透。），<br>发现，由于脚本是录制下来的，所以每次发送的token都是同一个，所以系统自然认为是同一个用户不断的在登陆。</p>
<p>需求出来了，我需要从某个httprequest的response中提取部分参数，作为下一个request的部分参数。</p>
<p><img src="https://reeg0a.bay.livefilestore.com/y1pp8EmQ60SdKGa1IAg4u-62jYlLwlwf_j9CIojNOdilYMYzzEHKVzs6SpQv70pNxf4HwN-KfAhPPzSrkrv-_XP-eHRyyvOHJmO/response.JPG?psid=1" alt="alt text"></p>
<p>如图，第二个str后面的字串就是用户的token，我需要把它传入下一个request的参数中去。</p>
<p><img src="https://recfxa.bay.livefilestore.com/y1pMynMzxahrPPlvf4yzXo7Wp6ehUhL5E8Y8bFtYtuAmay5r6xKWE90E95V2bGFf8MbdYs1pkWuxGCPDVr4ohwdRwg1rKuBRc01/request.JPG?psid=1" alt="alt text"></p>
<p>在需要获取response参数的那个request下面挂上一个Regular Expression Extractor.</p>
<p><img src="https://reenfw.bay.livefilestore.com/y1p0k0lbPYe3AVDtDOl9t_Yp_ZDGcKKNjpAO-KsipikIOC9XCtmxOWIL6Oscwnk67ShHQjKsg6R7-lX9VuvgPaInhc6EfiFg4oc/addComponent.jpg?psid=1" alt="alt text"></p>
<p>对Regular Expression Extractor界面的一些地方做下说明：</p>
<p><img src="https://redcja.bay.livefilestore.com/y1pbIsumJXdcJ3U79vtaIyLRUl3cxh-CR20K5sIssdtZFkS0mz-664UjZQ9PRGLJvkepu8RNeQJMfCMpDKGNhfH_2H6SBXDQX1e/REextractor.JPG?psid=1" alt="alt text"></p>
<p><code>response field to check</code>: 需要你自己选定是对response的内容还是头，还是url进行抓取。</p>
<p><code>reference name</code>： 抓取出来的变量名称，自己取名，因为之后你需要用到。</p>
<p><code>regular expression</code>： 这个是最重要的，正则表达式就写在这里。 正则表达式的正确与否，是你抓取的关键。</p>
<p><code>template</code>： 提取正则表达式里面的内容，通常我们只提取一个字串，所以通常都是$1$。</p>
<p><code>match number</code>： 匹配数字， 通常我们只提取一个字串，所以写1无妨。</p>
<p><code>Default Value</code>: 缺省值，用于没有抓取到值时的处理。</p>
<p>这样，我们通过<code>{var}</code>的方式，把变量写入request里面。</p>
<p><img src="https://refwuq.bay.livefilestore.com/y1pORO3eVDUFU0HTGOOAoofQ_ko1kO9b5yE1wQMZAuLm5aDbWhLJFgps8_ad4sy2YzYMoDz9yUKT7Rn0reT37sA9XKwI-PLST79/request2.JPG?psid=1" alt="alt text"></p>
<p>然后，跑了一下整个脚本，发现一切都正常了，这场“血案”暂告一个段落。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/jmeter/">Jmeter</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test-china-org/">test-china.org</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-04-26-htmlunit-jie-shao" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/04/26/2013-04-26-htmlunit-jie-shao/" class="article-date">
  	<time datetime="2013-04-26T13:37:00.000Z" itemprop="datePublished">2013-04-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/04/26/2013-04-26-htmlunit-jie-shao/">HtmlUnit 介绍</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>在 @Lily 的 <a href="http://test-china.org/topics/8" target="_blank" rel="external">Juint4 + WebDriver 入门篇</a> 中， Lily 问起了 HtmlUnit Driver。对 HtmlUnit Driver 我倒是没有接触太多， 所以特意去找了些文章看看。</p>
<p>在 <a href="http://code.google.com/p/selenium/wiki/HtmlUnitDriver" target="_blank" rel="external">selenium 官方 wiki</a> 上说：</p>
<blockquote>
<p>This is currently the fastest and most lightweight implementation of WebDriver. As the name suggests, this is based on HtmlUnit.</p>
</blockquote>
<p>所以想要了解 HtmlUnit Driver， 就必先追根溯源地研究下 HtmlUnit。</p>
<blockquote>
<p>HtmlUnit is a “GUI-Less browser for Java programs”. It models HTML documents and provides an API that allows you to invoke pages, fill out forms, click links, etc… just like you do in your “normal” browser.</p>
</blockquote>
<p>简单来说， HtmlUnit 就是没有界面的，你看不见的，但是却能做浏览器的活的 JAVA 版本的浏览器。需要说明的是，<strong>HtmlUnit 本身不是一个测试框架， 它真的只是一个模拟浏览器行为的程序。</strong> 所以需要和 Junit 或者 TestNG 等测试框架配合起来使用。同时，很多开源的工具也使用 HtmlUnit 来模拟浏览器行为，比如大名鼎鼎的 WebDriver。</p>
<p>下面，搬抄一把 HtmlUnit 的入门指南：</p>
<h2 id="建立项目"><a href="#建立项目" class="headerlink" title="建立项目"></a>建立项目</h2><p>使用 maven 创建一个 htmlunit 的试用项目</p>
<pre><code>mvn archetype:generate -DgroupId=com.testchina -DartifactId=my-htmlunit-test -DinteractiveMode=false
</code></pre><p>（不得不夸下 Maven， 构建的好工具啊。）</p>
<p>修改 pom.xml， 加入 HtmlUnit 依赖， 升级 Junit 为4.10。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.testchina<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-htmlunit-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>my-htmlunit-test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sourceforge.htmlunit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>htmlunit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后，执行：</p>
<ol>
<li><code>mvn install</code></li>
<li><code>mvn eclipse:eclipse</code></li>
</ol>
<p>之后， 就可以在 eclipse 里导入项目。接着，我们来写第一个例子。</p>
<h2 id="试用"><a href="#试用" class="headerlink" title="试用"></a>试用</h2><p><strong>第一个例子：</strong></p>
<p>a. 访问 <a href="http://htmlunit.sourceforge.net" target="_blank" rel="external">http://htmlunit.sourceforge.net</a></p>
<p>b. 验证网页的 titile</p>
<p>c. 验证网页内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testchina;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> com.gargoylesoftware.htmlunit.WebClient;</span><br><span class="line"><span class="keyword">import</span> com.gargoylesoftware.htmlunit.html.HtmlPage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHtmlUnitTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">homePage</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient(); <span class="comment">// 建立 WebClient。</span></span><br><span class="line">        <span class="keyword">final</span> HtmlPage page = webClient.getPage(<span class="string">"http://htmlunit.sourceforge.net"</span>); <span class="comment">// 访问网站，返回页面对象。</span></span><br><span class="line">        assertEquals(<span class="string">"HtmlUnit - Welcome to HtmlUnit"</span>, page.getTitleText()); <span class="comment">// 验证 title。</span></span><br><span class="line">        <span class="comment">/** 验证网页内容 */</span></span><br><span class="line">        <span class="keyword">final</span> String pageAsXml = page.asXml();</span><br><span class="line">        assertTrue(pageAsXml.contains(<span class="string">"&lt;body class=\"composite\"&gt;"</span>));</span><br><span class="line">        <span class="keyword">final</span> String pageAsText = page.asText();</span><br><span class="line">        assertTrue(pageAsText.contains(<span class="string">"Support for the HTTP and HTTPS protocols"</span>));</span><br><span class="line">        webClient.closeAllWindows();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第二个例子: 指定浏览器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">homePage_Firefox</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient(BrowserVersion.FIREFOX_10);</span><br><span class="line">    <span class="keyword">final</span> HtmlPage page = webClient</span><br><span class="line">            .getPage(<span class="string">"http://htmlunit.sourceforge.net"</span>);</span><br><span class="line">    assertEquals(<span class="string">"HtmlUnit - Welcome to HtmlUnit"</span>, page.getTitleText());</span><br><span class="line"></span><br><span class="line">    webClient.closeAllWindows();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，在初始化 WebClient 的时候，传入浏览器版本， 目前 2.10 里面支持：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Register plugins for the browser versions. */</span></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       INTERNET_EXPLORER_6.initDefaultFeatures();</span><br><span class="line">       INTERNET_EXPLORER_7.initDefaultFeatures();</span><br><span class="line">       INTERNET_EXPLORER_8.initDefaultFeatures();</span><br><span class="line"></span><br><span class="line">       FIREFOX_3.initDefaultFeatures();</span><br><span class="line">       FIREFOX_3_6.initDefaultFeatures();</span><br><span class="line">       FIREFOX_10.initDefaultFeatures();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> PluginConfiguration flash = <span class="keyword">new</span> PluginConfiguration(<span class="string">"Shockwave Flash"</span>,</span><br><span class="line">           <span class="string">"Shockwave Flash 9.0 r31"</span>, <span class="string">"libflashplayer.so"</span>);</span><br><span class="line">       flash.getMimeTypes().add(<span class="keyword">new</span> PluginConfiguration.MimeType(<span class="string">"application/x-shockwave-flash"</span>,</span><br><span class="line">           <span class="string">"Shockwave Flash"</span>, <span class="string">"swf"</span>));</span><br><span class="line">       FIREFOX_3.getPlugins().add(flash);</span><br><span class="line">       FIREFOX_3_6.getPlugins().add(flash);</span><br><span class="line">       FIREFOX_10.getPlugins().add(flash);</span><br><span class="line"></span><br><span class="line">       CHROME_16.initDefaultFeatures();</span><br><span class="line">       CHROME_16.setApplicationCodeName(<span class="string">"Mozilla"</span>);</span><br><span class="line">       CHROME_16.setPlatform(<span class="string">"MacIntel"</span>);</span><br><span class="line">       CHROME_16.setCpuClass(<span class="keyword">null</span>);</span><br><span class="line">       CHROME_16.setBrowserLanguage(<span class="string">"undefined"</span>);</span><br><span class="line">       <span class="comment">// there are other issues with Chrome; a different productSub, etc.</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>第三个例子： 获取页面元素</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getElements</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient();</span><br><span class="line">    <span class="keyword">final</span> HtmlPage page = webClient.getPage(<span class="string">"http://htmlunit.sourceforge.net"</span>);</span><br><span class="line">    <span class="comment">//get list of all divs</span></span><br><span class="line">    <span class="keyword">final</span> List&lt;?&gt; divs = page.getByXPath(<span class="string">"//div"</span>); <span class="comment">// 返回所有的div</span></span><br><span class="line">    System.out.println(((HtmlDivision)divs.get(<span class="number">0</span>)).asText()); <span class="comment">// 得到第一个 Div 节点的内容。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 返回所有的超链接， 并打印 name 属性*/</span></span><br><span class="line">    <span class="keyword">final</span> List&lt;HtmlAnchor&gt; anchors = page.getAnchors();</span><br><span class="line">    <span class="keyword">for</span> (HtmlAnchor anchor : anchors) &#123;</span><br><span class="line">        System.out.println(anchor.getAttribute(<span class="string">"name"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    webClient.closeAllWindows();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第四个例子： 提交表单</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submittingForm</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the first page</span></span><br><span class="line">    <span class="keyword">final</span> HtmlPage page1 = webClient.getPage(<span class="string">"http://some_url"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the form that we are dealing with and within that form,</span></span><br><span class="line">    <span class="comment">// find the submit button and the field that we want to change.</span></span><br><span class="line">    <span class="keyword">final</span> HtmlForm form = page1.getFormByName(<span class="string">"myform"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> HtmlSubmitInput button = form.getInputByName(<span class="string">"submitbutton"</span>);</span><br><span class="line">    <span class="keyword">final</span> HtmlTextInput textField = form.getInputByName(<span class="string">"userid"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Change the value of the text field</span></span><br><span class="line">    textField.setValueAttribute(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now submit the form by clicking the button and get back the second page.</span></span><br><span class="line">    <span class="keyword">final</span> HtmlPage page2 = button.click();</span><br><span class="line"></span><br><span class="line">    webClient.closeAllWindows();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>是不是很棒？ 所有浏览器能做的，它都能做，我们再来看下它的特性：</p>
<ul>
<li>支持 HTTP and HTTPS 协议</li>
<li>支持 cookies</li>
<li>支持 Post， Get， Head， Delete</li>
<li>支持代理</li>
<li>能分析 HTTP responses</li>
<li>能自定义 HTTP request head</li>
<li>支持 Javascript</li>
</ul>
<p>于是有<br><strong>第五个例子： 使用 javascript</strong></p>
<p>这里的 Javascript 的意思，是指 HtmlUnit 可以通过 js 引擎执行 javascript 代码。</p>
<blockquote>
<p>HtmlUnit provides excellent JavaScript support, simulating the behavior of the configured browser (Firefox or Internet Explorer). It uses the Rhino JavaScript engine for the core language (plus workarounds for some Rhino bugs) and provides the implementation for the objects specific to execution in a browser.</p>
</blockquote>
<p>比如我们的页面有一个 alert 事件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Alert sample<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">'alert("foo");'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们如何捕捉它呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">alerts</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> WebClient webClient = <span class="keyword">new</span> WebClient();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List collectedAlerts = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    webClient.setAlertHandler(<span class="keyword">new</span> CollectingAlertHandler(collectedAlerts));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Since we aren't actually manipulating the page, we don't assign</span></span><br><span class="line">    <span class="comment">// it to a variable - it's enough to know that it loaded.</span></span><br><span class="line">    webClient.getPage(<span class="string">"http://tciludev01/test.html"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List expectedAlerts = Collections.singletonList(<span class="string">"foo"</span>);</span><br><span class="line">    assertEquals(expectedAlerts, collectedAlerts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是不是很轻巧？ 像真正的浏览器一样， HtmlUnit 可以响应各种 Javascript 事件， 执行各种 Javascript 代码。</p>
<hr>
<p>对于 HtmlUnit， 我就初略看了看， 总的印象是轻，不用启动笨重的浏览器就能做到和浏览器一样的行为， 和 Junit4 很好的搭配，可以<br>写出轻巧优美的测试案例， 同时也能为测试省去不少时间。这在前期测试驱动开发的时候，特别是 Web 应用开发，可以节省去不少时间。</p>
<p>参见:</p>
<p><a href="http://htmlunit.sourceforge.net/" target="_blank" rel="external">http://htmlunit.sourceforge.net/</a></p>
<p><a href="http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html" target="_blank" rel="external">http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html</a></p>
<p><a href="http://code.google.com/p/selenium/wiki/HtmlUnitDriver" target="_blank" rel="external">http://code.google.com/p/selenium/wiki/HtmlUnitDriver</a></p>
<p><a href="http://htmlunit.sourceforge.net/javascript-howto.html" target="_blank" rel="external">http://htmlunit.sourceforge.net/javascript-howto.html</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/webdriver/">WebDriver</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test-china-org/">test-china.org</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-03-21-windowsxia-cha-zhao-zhan-yong-duan-kou-de-jin-cheng" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/03/21/2013-03-21-windowsxia-cha-zhao-zhan-yong-duan-kou-de-jin-cheng/" class="article-date">
  	<time datetime="2013-03-21T13:02:00.000Z" itemprop="datePublished">2013-03-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/03/21/2013-03-21-windowsxia-cha-zhao-zhan-yong-duan-kou-de-jin-cheng/">windows 下查找占用端口的进程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>一直只知道 *nux 下的命令，对 windows 知之甚少，其实 windows 下也有很多强大的命令。</p>
<p>比如在 linux 下查看一个 mysql 的端口，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">➜  octopress git:(source) ✗ netstat -an | grep 3306 # mac 下的命令没有 linux 下来的丰富啊，没有 p 选项。</span><br><span class="line">tcp4       0      0  *.3306                 *.*                    LISTEN</span><br><span class="line"></span><br><span class="line">root@li493-58:~# netstat -anp | grep 3306 # 这是 ubuntu 下面的。</span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      2509/mysqld</span><br></pre></td></tr></table></figure>
<p>很方便吧。那么如果在 windows 下呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">netstat -ano | findstr 3306 # 这里会把 pid 告诉你，比如 pid 是 1278</span><br><span class="line"></span><br><span class="line">tasklist /fi &quot;pid eq 1278&quot; # 这样就找到了 1278 对应的进程</span><br></pre></td></tr></table></figure>
<p>也是很简单的吧！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/windows/">windows</a>
	</div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
    <article id="post-2013-02-12-shi-yong-capybara-deng-lu-bai-du" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2013/02/12/2013-02-12-shi-yong-capybara-deng-lu-bai-du/" class="article-date">
  	<time datetime="2013-02-12T09:14:00.000Z" itemprop="datePublished">2013-02-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/02/12/2013-02-12-shi-yong-capybara-deng-lu-bai-du/">使用 capybara 登陆百度</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>ShiLongLu 问你有什么办法测试百度的登录窗口呢？这是差不多2个月前的问题了，我一直忙于 Dota 圣剑传说。恰巧春节有时间看了下。</p>
<p>百度登陆的时候是弹出一个对话框，如图：</p>
<p><img src="/photos/baidulogin.png" alt=""></p>
<p>但是这个对话框是用 iframe 实现的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">height</span>=<span class="string">"100%"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">scrolling</span>=<span class="string">"no"</span> <span class="attr">src</span>=<span class="string">"http://www.baidu.com/cache/user/html/login-1.2.html"</span> <span class="attr">marginheight</span>=<span class="string">"0"</span> <span class="attr">marginwidth</span>=<span class="string">"0"</span> <span class="attr">id</span>=<span class="string">"login_iframe"</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>所以在填写用户名和密码的时候，需要先 switch 到这个 frame 上去， </p>
<blockquote>
<p>When working inside a frame, you should use Capybara’s within_frame method.</p>
<ul>
<li>(Object) within_frame(frame_id)</li>
</ul>
<p>Execute the given block within the given iframe given the id of that iframe. Only works on some drivers (e.g. Selenium)</p>
<p>Parameters:<br>frame_id (String) — Id of the frame</p>
</blockquote>
<p>所以我们的实现基本如下：</p>
<p>baidu.feature:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Given I am on baidu.com</span><br><span class="line">When I  click <span class="string">"登录"</span></span><br><span class="line">And I switch to login form</span><br><span class="line">And I enter <span class="string">"lihuazhang@hotmail.com"</span> <span class="keyword">for</span> <span class="string">"帐号"</span></span><br><span class="line">And I enter <span class="string">"204646"</span> <span class="keyword">for</span> <span class="string">"密码"</span></span><br><span class="line">And I click <span class="string">"登录"</span> button</span><br><span class="line">Then I should see <span class="string">"zhangzuichi"</span></span><br></pre></td></tr></table></figure>
<p>step_definition.rb:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">When /^I enter <span class="string">"(.*?)"</span> <span class="keyword">for</span> <span class="string">"(.*?)"</span>$/ <span class="keyword">do</span> <span class="params">|value, key|</span></span><br><span class="line">  <span class="keyword">if</span> key == <span class="string">"帐号"</span></span><br><span class="line">    within_frame <span class="string">'login_iframe'</span> <span class="keyword">do</span></span><br><span class="line">      fill_in <span class="string">'pass_login_username_0'</span>, <span class="symbol">:with</span> =&gt; value</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">     within_frame <span class="string">'login_iframe'</span> <span class="keyword">do</span></span><br><span class="line">      fill_in <span class="string">'pass_login_password_0'</span>, <span class="symbol">:with</span> =&gt; value</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">When /^I click <span class="string">"(.*?)"</span> button$/ <span class="keyword">do</span> <span class="params">|arg1|</span></span><br><span class="line">  within_frame <span class="string">'login_iframe'</span> <span class="keyword">do</span></span><br><span class="line">    click_button <span class="string">'pass_login_input_submit_0'</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>大致如此，在 firefox 下测试通过。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/capybara/">Capybara</a>
	</div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
    


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2016 恒温
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="site-visit" >本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style='display:none'>
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    
	<script>
		var yiliaConfig = {
			fancybox: false,
			mathjax: true,
			animate: true,
			isHome: true,
			isPost: false,
			isArchive: false,
			isTag: false,
			isCategory: false,
			open_in_new: false
		}
	</script>


<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#top" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>